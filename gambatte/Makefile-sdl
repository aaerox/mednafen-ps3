#SHAMELESSLY STOLEN FROM http://mrbook.org/tutorials/make/
CXX=g++
CC=gcc
LD=g++

CFLAGS=-g -c -DPSGL -I/usr/include/SDL -Isrc/common -Isrc/libgambatte/include -Isrc/libgambatte/src -I../system-sdl -DHAVE_STDINT_H
LDFLAGS=-L../system-sdl -lemusys -lSDL -lz

CXXSOURCES= src/main.cpp src/gambatte_help.cpp src/libgambatte/src/bitmap_font.cpp src/libgambatte/src/colorconversion.cpp src/libgambatte/src/cpu.cpp src/libgambatte/src/gambatte.cpp src/libgambatte/src/initstate.cpp src/libgambatte/src/interrupter.cpp src/libgambatte/src/memory.cpp src/libgambatte/src/rtc.cpp src/libgambatte/src/sound.cpp src/libgambatte/src/state_osd_elements.cpp src/libgambatte/src/statesaver.cpp src/libgambatte/src/video.cpp src/libgambatte/src/file/file.cpp src/libgambatte/src/sound/channel1.cpp src/libgambatte/src/sound/channel2.cpp src/libgambatte/src/sound/channel3.cpp src/libgambatte/src/sound/channel4.cpp src/libgambatte/src/sound/duty_unit.cpp src/libgambatte/src/sound/envelope_unit.cpp src/libgambatte/src/sound/length_counter.cpp src/libgambatte/src/video/basic_add_event.cpp src/libgambatte/src/video/break_event.cpp src/libgambatte/src/video/irq_event.cpp src/libgambatte/src/video/ly_counter.cpp src/libgambatte/src/video/lyc_irq.cpp src/libgambatte/src/video/m3_extra_cycles.cpp src/libgambatte/src/video/mode0_irq.cpp src/libgambatte/src/video/mode1_irq.cpp src/libgambatte/src/video/mode2_irq.cpp src/libgambatte/src/video/mode3_event.cpp src/libgambatte/src/video/sc_reader.cpp src/libgambatte/src/video/scx_reader.cpp src/libgambatte/src/video/sprite_mapper.cpp src/libgambatte/src/video/we.cpp src/libgambatte/src/video/we_master_checker.cpp src/libgambatte/src/video/wx_reader.cpp src/libgambatte/src/video/wy.cpp src/libgambatte/src/video/filters/catrom2x.cpp src/libgambatte/src/video/filters/catrom3x.cpp src/libgambatte/src/video/filters/kreed2xsai.cpp src/libgambatte/src/video/filters/maxsthq2x.cpp src/libgambatte/src/video/filters/maxsthq3x.cpp src/common/resample/resamplerinfo.cpp src/common/resample/chainresampler.cpp src/common/resample/u48div.cpp
CXXOBJECTS=$(CXXSOURCES:.cpp=.o)

CSOURCES= 
COBJECTS=$(CSOURCES:.c=.o)

BINARY=gambatte.elf

all: $(CSOURCES) $(CXXSOURCES) $(BINARY)
	
$(BINARY): $(COBJECTS) $(CXXOBJECTS) 
	$(LD) $(CXXOBJECTS) $(COBJECTS) $(LDFLAGS) -o $@

%.o : %.cpp
	$(CXX) $(CFLAGS) -MD -o $@ $<
	@cp $*.d $*.P; \
	sed -e 's/#.*//' -e 's/^[^:]*: *//' -e 's/ *\\$$//' \
		-e '/^$$/ d' -e 's/$$/ :/' < $*.d >> $*.P; \
	rm -f $*.d	

%.o : %.c
	$(CC) $(CFLAGS) -MD -o $@ $<
	@cp $*.d $*.P; \
	sed -e 's/#.*//' -e 's/^[^:]*: *//' -e 's/ *\\$$//' \
		-e '/^$$/ d' -e 's/$$/ :/' < $*.d >> $*.P; \
	rm -f $*.d	
	
	
.PHONY: clean
.SILENT: clean
clean:
	echo Cleaning
	rm -f $(COBJECTS) $(CSOURCES:.c=.P) $(CXXOBJECTS) $(CXXSOURCES:.cpp=.P) $(BINARY) pkg/USRDIR/EBOOT.BIN 2> /dev/null
	

